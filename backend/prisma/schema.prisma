// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid()) @db.Uuid
  phone         String?
  email         String    @unique
  firstName     String?   @map("first_name")
  lastName      String?   @map("last_name")
  handicapType  String?   @map("handicap_type")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  reviews   Review[]
  bookings  Booking[]

  @@map("users")
}

model Center {
  id              BigInt    @id @default(autoincrement())
  name            String
  address         String    @db.Text
  latitude        Decimal   @db.Decimal(10, 8)
  longitude       Decimal   @db.Decimal(11, 8)
  doctolibRefId   String?   @unique @map("doctolib_ref_id")
  avgRating       Decimal   @default(0) @map("avg_rating") @db.Decimal(3, 2)
  verifiedAccess  Boolean   @default(false) @map("verified_access")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  accessibilitySpecs  AccessibilitySpec?
  reviews             Review[]
  bookings            Booking[]

  @@map("centers")
}

model AccessibilitySpec {
  centerId          BigInt   @id @map("center_id")
  hasRamp           Boolean  @default(false) @map("has_ramp")
  hasElevator       Boolean  @default(false) @map("has_elevator")
  doorWidthCm       Int?     @map("door_width_cm")
  hasBrailleSignage Boolean  @default(false) @map("has_braille_signage")
  hasAudioGuidance  Boolean  @default(false) @map("has_audio_guidance")
  hasQuietZone      Boolean  @default(false) @map("has_quiet_zone")
  staffTrained      Boolean  @default(false) @map("staff_trained")
  websiteAccessible Boolean  @default(false) @map("website_accessible")
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  center Center @relation(fields: [centerId], references: [id], onDelete: Cascade)

  @@map("accessibility_specs")
}

model Review {
  id        BigInt   @id @default(autoincrement())
  centerId  BigInt   @map("center_id")
  userId    String   @map("user_id") @db.Uuid
  rating    Int
  comment   String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  center Center @relation(fields: [centerId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("reviews")
}

model Booking {
  id                BigInt    @id @default(autoincrement())
  userId            String    @map("user_id") @db.Uuid
  centerId          BigInt    @map("center_id")
  externalBookingId String?   @map("external_booking_id")
  appointmentTime   DateTime  @map("appointment_time")
  status            String    @default("confirmed")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  center Center @relation(fields: [centerId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("bookings")
}
